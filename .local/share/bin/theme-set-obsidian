#!/bin/bash

CURRENT_THEME_DIR="$HOME/.config/theme/current/theme"

[ -f "$CURRENT_THEME_DIR/obsidian.css" ] || exit 0

jq -r '.vaults | values[].path' ~/.config/obsidian/obsidian.json 2>/dev/null | while read -r vault_path; do
  [ -d "$vault_path/.obsidian" ] || continue

  theme_dir="$vault_path/.obsidian/themes/SystemTheme"
  mkdir -p "$theme_dir"

  [ -f "$theme_dir/manifest.json" ] || cat >"$theme_dir/manifest.json" <<'EOF'
{
  "name": "SystemTheme",
  "version": "1.0.0",
  "minAppVersion": "0.16.0",
  "description": "Automatically syncs with your current system theme colors and fonts",
  "author": "System",
  "authorUrl": "https://example.local"
}
EOF

  cp "$CURRENT_THEME_DIR/obsidian.css" "$theme_dir/theme.css"
done
